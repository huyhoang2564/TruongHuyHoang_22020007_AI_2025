<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vietnamese Food Classifier</title>
  <style>
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: radial-gradient(circle at 20% 20%, #ffffff 0%, #eef2ff 100%);
      padding: 40px;
      color: #222;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
      background: #fff;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.08);
      text-align: center;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 20px;
      color: #1f2937;
      font-weight: 600;
    }


    .upload-area:hover {
      border-color: #4f46e5;
      background-color: #f4f4ff;
    }

    .upload-text {
      color: #4b5563;
      font-size: 15px;
      line-height: 1.4;
    }

    .upload-hint {
      font-size: 13px;
      color: #9ca3af;
      margin-top: 6px;
    }

    #fileInput {
      display: none;
    }

    .preview-section {
      display: none;
      margin-bottom: 20px;
    }

    .preview-box {
      display: inline-block;
      max-width: 100%;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      background: #f9fafb;
      padding: 12px;
    }

    #previewImg {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      display: block;
      margin: 0 auto;
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-top: 16px;
    }

    button.action-btn {
      padding: 12px 16px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
      min-width: 150px;
    }

    #changeImageBtn {
      background: #6b7280;
      color: #fff;
    }
    #changeImageBtn:hover {
      background: #4b5563;
    }

    #predictBtn {
      background: #4f46e5;
      color: #fff;
    }
    #predictBtn:hover {
      background: #4338ca;
    }

    .loading {
      margin-top: 15px;
      font-size: 14px;
      color: #6b7280;
      display: none;
    }

    .result {
      background: #f9fafb;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 16px;
      margin-top: 20px;
      text-align: left;
      display: none;
    }

    .result h2 {
      margin: 0 0 10px;
      font-size: 18px;
      color: #111827;
      font-weight: 600;
    }

    .result strong {
      color: #374151;
    }

    ul {
      margin: 8px 0 0;
      padding-left: 20px;
      color: #4b5563;
      font-size: 14px;
      line-height: 1.4;
    }

  </style>
</head>
<body>
  <div class="container">
    <h1>Vietnamese Food Classifier</h1>

    <!-- KHI CH∆ØA C√ì ·∫¢NH -->
    <label class="upload-area" id="uploadArea">
      <div class="upload-text">
        üì∏ Click or Drop an Image Here
      </div>
      <div class="upload-hint">
        JPG / PNG ‚Ä¢ Any size ‚Ä¢ Clear food photo
      </div>

      <input id="fileInput" type="file" accept="image/*" />
    </label>

    <!-- KHI ƒê√É C√ì ·∫¢NH -->
    <div class="preview-section" id="previewSection">
      <div class="preview-box">
        <img id="previewImg" src="" alt="Your image preview" />
      </div>

      <div class="controls-row">
        <button class="action-btn" id="changeImageBtn">Change Image</button>
        <button class="action-btn" id="predictBtn">Predict Dish</button>
      </div>
    </div>

    <div id="loading" class="loading">
      üîç Predicting... Please wait...
    </div>

    <div id="result" class="result">
      <h2 id="dishName"></h2>
      <p><strong>Ingredients:</strong></p>
      <ul id="ingredientsList"></ul>
    </div>
  </div>

  <script>
    const fileInput        = document.getElementById("fileInput");
    const uploadArea       = document.getElementById("uploadArea");
    const previewSection   = document.getElementById("previewSection");
    const previewImg       = document.getElementById("previewImg");
    const changeImageBtn   = document.getElementById("changeImageBtn");
    const predictBtn       = document.getElementById("predictBtn");
    const loadingEl        = document.getElementById("loading");
    const resultBox        = document.getElementById("result");
    const dishNameEl       = document.getElementById("dishName");
    const ingredientsList  = document.getElementById("ingredientsList");

    function clearResult() {
      resultBox.style.display = "none";
      dishNameEl.textContent = "";
      ingredientsList.innerHTML = "";
    }

    function showPreviewFromFile(file) {
      if (!file) return;

      const url = URL.createObjectURL(file);

      previewImg.src = url;
      previewSection.style.display = "block";
      uploadArea.style.display = "none";

      clearResult();
    }

    changeImageBtn.addEventListener("click", () => {
      fileInput.click();
    });


    fileInput.addEventListener("change", () => {
      const file = fileInput.files[0];
      if (!file) return;
      showPreviewFromFile(file);
    });

    ;(() => {
      const preventDefaults = (e) => {
        e.preventDefault();
        e.stopPropagation();
      };

      ["dragenter","dragover","dragleave","drop"].forEach(ev => {
        uploadArea.addEventListener(ev, preventDefaults, false);
      });

      ["dragenter","dragover"].forEach(ev => {
        uploadArea.addEventListener(ev, () => {
          uploadArea.style.borderColor = "#4f46e5";
          uploadArea.style.backgroundColor = "#f4f4ff";
        });
      });

      ["dragleave","drop"].forEach(ev => {
        uploadArea.addEventListener(ev, () => {
          uploadArea.style.borderColor = "#999";
          uploadArea.style.backgroundColor =
            "repeating-linear-gradient(-45deg,rgba(249,250,251,0.9)0px,rgba(249,250,251,0.9)10px,rgba(255,255,255,0.9)10px,rgba(255,255,255,0.9)20px)";
        });
      });

      uploadArea.addEventListener("drop", (e) => {
        const dt = e.dataTransfer;
        const file = dt.files[0];
        if (!file) return;

      
        const dataTransfer = new DataTransfer();
        dataTransfer.items.add(file);
        fileInput.files = dataTransfer.files;

        showPreviewFromFile(file);
      });
    })();

    predictBtn.addEventListener("click", async () => {
      const file = fileInput.files[0];
      if (!file) {
        alert("Please choose an image first!");
        return;
      }

      loadingEl.style.display = "block";
      resultBox.style.display = "none";

      const formData = new FormData();
      formData.append("image", file);

      try {
        const res = await fetch("/predict", {
          method: "POST",
          body: formData
        });

        const data = await res.json();

        loadingEl.style.display = "none";

        dishNameEl.textContent = "üçΩÔ∏è Dish: " + (data.prediction || "Unknown");
        ingredientsList.innerHTML = "";

        if (data.ingredients && data.ingredients.length > 0) {
          data.ingredients.forEach(item => {
            const li = document.createElement("li");
            li.textContent = item;
            ingredientsList.appendChild(li);
          });
        } else {
          const li = document.createElement("li");
          li.textContent = "No ingredient info.";
          ingredientsList.appendChild(li);
        }

        resultBox.style.display = "block";

        fileInput.value = "";

      } catch (err) {
        loadingEl.style.display = "none";
        alert("Error predicting image.");
        console.error(err);
      }
    });
  </script>
</body>
</html>
